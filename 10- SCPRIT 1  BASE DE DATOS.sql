-- INSTITUTO NACIONAL DE APRENDIZAJE
-- MODULO BASES DE DATOS
-- JAFET DANIEL ULATE ALVAREZ
-- TERCERA PARTE DEL PROYECTO
-- EN ESTE SCRIPT SE ENCUENTRA
-- 1- CREACION DE LA BASE DE DATOS
-- 2- CREACION DE LAS TABLAS 
-- 3- RESTRICIONES DE LA TABLAS
-- 4- RELACIONES DE LA TABLAS
-- 5- INSERCION DE LOS DATOS
CREATE DATABASE BASE_DATOS_PROYECTO
GO
USE BASE_DATOS_PROYECTO
GO

-- CREACION DE LA TABLA DE MATRICULAS

CREATE TABLE MATRICULAS(
	NUM_RECIBO	int identity primary key NOT NULL,
	CARNET_EST	varchar(30) NOT NULL,
	COD_MODULO varchar(10),
	FECHA date default getdate() NOT NULL,
	MONTO decimal (10,2)NOT NULL,
	ENCARGADO_MATRICULA varchar(30) NOT NULL,
	ESTADO_MATRICULA varchar(10) ,
	OBSERVACIONES_MATRICULA varchar(200) 
);
--- RESTRICCION DE TABLA MATRICULAS---
 ALTER TABLE MATRICULAS
 ADD CONSTRAINT RX_ESTADO CHECK(ESTADO_MATRICULA='ACTIVO' OR ESTADO_MATRICULA='INACTIVO')
 

 -- CREACION DE LA TABLA ESTUDIANTES---

 CREATE TABLE ESTUDIANTES(
	CARNET_EST varchar(30) primary key NOT NULL,
	CEDULA_EST int unique NOT NULL,
	NOMBRE_EST varchar(30) NOT NULL,
	APELLIDO1_EST varchar(30) NOT NULL,
	APELLIDO2_EST varchar(30) NOT NULL,
	CORREO_EST varchar(30) NOT NULL,
	EDAD_EST int NOT NULL,
	TELEFONO_EST int NOT NULL,
	FECHA_INGRESO_EST date NOT NULL,
	ESTADO_EST varchar(10) default 'ACTIVO',
	BORRADO_EST bit default 0 NOT NULL
);
-- RESTRICIONES DE LA TABLA ESTUDIANTES--
 ALTER TABLE ESTUDIANTES
 ADD CONSTRAINT RX_ESTADO_EST CHECK(ESTADO_EST='ACTIVO' OR ESTADO_EST='INACTIVO')
	

-- CREACION DE LA TABLA PROFESORES--
CREATE TABLE PROFESORES(
	COD_PROF INT primary key NOT NULL,
	CEDULA_PROF varchar(20) NOT NULL,
	NOMBRE_PROF varchar(20) NOT NULL,
	APELLIDO1_PROF varchar(20) NOT NULL,
	APELLIDO2_PROF varchar(20) NOT NULL,
	CORREO_PROF varchar(30) NOT NULL,
	TELEFONO_PROF int NOT NULL,
	ESTADO_PROF varchar(10) default 'ACTIVO',
	BORRADO_PROF bit default 0 NOT NULL
);


--CREACION DE LA TABLA DE HORARIOS
CREATE TABLE HORARIOS(
	DIA varchar(10 )NOT NULL,
	HORA_INICIO time NOT NULL,
	HORA_FIN time NOT NULL,
	COD_PROGRAMAS_MODULOS_ABIERTOS INT
	CONSTRAINT PK_HORARIOS PRIMARY KEY(COD_PROGRAMAS_MODULOS_ABIERTOS,DIA,HORA_INICIO,HORA_FIN)
);
-- RESTRICCION DE LA TABLA HORARIOS--
ALTER TABLE HORARIOS
ADD CONSTRAINT RX_DIA CHECK(DIA='LUNES'or DIA= 'MARTES'or DIA='MIERCOLES'or DIA='JUEVES'or DIA='VIERNES')

-- CREACIO DE LA TABLA MODULOS
CREATE TABLE MODULOS(
	COD_MODULO varchar(10) primary key NOT NULL,
	NOMBRE_MODULO varchar (100) NOT NULL,
	BORRADO_MODULOS bit default 0,
	PRECIO_MODULO int NOT NULL,
	HORAS_MODULO int NOT NULL
);

-- CREACION DE LA TABLA PROGRAMAS--
CREATE TABLE PROGRAMAS (
	COD_PROGRAMA varchar(10)  primary key,
	NOMBRE_PROGRAMA varchar(100) NOT NULL,
	PRECIO_PROGRAMA int  NOT NULL,
	HORAS_PROGRAMA int NOT NULL
);

-- CREACION DE LA TABLA PROGRAMAS MODULOS--

CREATE TABLE PROGRAMAS_MODULOS(
	COD_PROGRAMAS_MODULOS INT IDENTITY primary key NOT NULL,
	COD_PROGRAMA varchar(10) NOT NULL,
	COD_MODULO varchar(10) NOT NULL,
	BORRADO_PROG_MODU bit default 0 
);


--  CREACION DE LA TABLA PROGRAMAS MODULOS ABIERTOS
CREATE TABLE PROGRAMAS_MODULOS_ABIERTOS(
	COD_PROGRAMAS_MODULOS_ABIERTOS INT   primary key,
	COD_PROF  INT,
	COD_PROGRAMAS_MODULOS INT,
	FECHA_INICIO date,
	COD_LABORATORIO varchar(10),
	GRUPO varchar (10),
	CUPO INT
);
ALTER TABLE PROGRAMAS_MODULOS_ABIERTOS
ADD  FECHA_FINAL DATE
-- CREACION DE LA TABLA  CERTIFICACIONES--
CREATE TABLE CERTIFICACIONES(
	 COD_CERTIFICACION INT primary key,
	 NOMBRE_CERTIFICADO varchar(30)
);

-- CREACION DE LA TABLA DETALLE MATRICULAS
 
CREATE TABLE DETALLE_MATRICULAS(
	NUM_RECIBO int IDENTITY NOT NULL,
	COD_PROGRAMAS_MODULOS_ABIERTOS INT ,
	ESTADO_DM varchar(10)  default 'ACTIVO',
	CONSTRAINT PK_DETALLE_MATRICULAS primary key(NUM_RECIBO,COD_PROGRAMAS_MODULOS_ABIERTOS)
)

ALTER TABLE DETALLE_MATRICULAS ADD CONSTRAINT CHK_ESTADOD 
CHECK(ESTADO_DM IN('ACTIVO','RETIRADO','APROBADO','REPROBADO'))

-- CREACION DE LA TABLA CALIFICACIONES--\

CREATE TABLE CALIFICACIONES(
	NUM_RECIBO INT,
	CARNET_EST varchar(10),
	NOTA_FINAL decimal(5,2) default 0,
	ESTADO_EST varchar(10) DEFAULT'APROBADO',
	COD_PROGRAMAS_MODULOS_ABIERTOS INT,
	CONSTRAINT PK_CALIFICA PRIMARY KEY(CARNET_EST,COD_PROGRAMAS_MODULOS_ABIERTOS )
);
-- RESTRICCION DE LA TABLA CALIFICACIONES
ALTER TABLE CALIFICACIONES ADD CONSTRAINT CHK_ESTADO_EST 
CHECK(ESTADO_EST IN('APROBADO','REPROBADO'))

-- CREACION DE LA TABLA HORARIOS
CREATE TABLE LABORATORIO(
	COD_LABORATORIO varchar(10) primary key,
	UBICACION varchar(80),
);

CREATE TABLE CERTIFICACIONES_PROF(
	COD_PROF int,
    COD_CERTIFICACION int
	CONSTRAINT PK_CER PRIMARY KEY(COD_PROF,COD_CERTIFICACION )
	);
	ALTER TABLE CERTIFICACIONES_PROF
   ADD CONSTRAINT FK_CERTI_PROFT FOREIGN KEY (COD_PROF) REFERENCES PROFESORES(COD_PROF)
   ALTER TABLE CERTIFICACIONES_PROF
    ADD CONSTRAINT FK_CERTI_PROF FOREIGN KEY (COD_CERTIFICACION) REFERENCES CERTIFICACIONES(COD_CERTIFICACION)


CREATE TABLE PAGOS(
	 CARNET_EST VARCHAR (10),
	 NUM_RECIBO INT,
	 MONTO_DE_PAGO INT,
	 FECHA_PAGO DATE,
	 DETALLE_PAGO VARCHAR(10)
	 CONSTRAINT PK_CALI PRIMARY KEY(CARNET_EST, NUM_RECIBO)
);

---


----------------------------------------------

-- CREACION DE LAS RELACIONES CON FORENIG KEY--

-- ESTUDIANTES A MATRICULAS
 ALTER TABLE MATRICULAS ADD CONSTRAINT FK_CAR_EST
	FOREIGN KEY (CARNET_EST) REFERENCES ESTUDIANTES(CARNET_EST); 

--MATRICULA A DETALLE MATRICULA
ALTER TABLE DETALLE_MATRICULAS ADD CONSTRAINT FK_NUM_RECI
	FOREIGN KEY (NUM_RECIBO) REFERENCES MATRICULAS(NUM_RECIBO);  

-- GRUPOS A HORARIOS
ALTER TABLE HORARIOS ADD CONSTRAINT FK_GRUP
	FOREIGN KEY (COD_PROGRAMAS_MODULOS_ABIERTOS) REFERENCES PROGRAMAS_MODULOS_ABIERTOS(COD_PROGRAMAS_MODULOS_ABIERTOS); 

-- LABORTORIOS A GRUPOS
ALTER TABLE PROGRAMAS_MODULOS_ABIERTOS ADD CONSTRAINT FK_LABOR
	FOREIGN KEY (COD_LABORATORIO) REFERENCES LABORATORIO(COD_LABORATORIO);  

--PROFESORES A PROGRAMAS  MODULOS ABIERTOS
ALTER TABLE PROGRAMAS_MODULOS_ABIERTOS ADD CONSTRAINT FK_PROF
	FOREIGN KEY (COD_PROF) REFERENCES PROFESORES(COD_PROF); 
	
-- PROGRAMAS A PROGRAMAS MODULOS
ALTER TABLE PROGRAMAS_MODULOS ADD CONSTRAINT FK_PROG
	FOREIGN KEY (COD_PROGRAMA) REFERENCES PROGRAMAS(COD_PROGRAMA);

-- MODULOS A A PROGRAMAS MODULOS
ALTER TABLE PROGRAMAS_MODULOS ADD CONSTRAINT FK_MODU
	FOREIGN KEY (COD_MODULO) REFERENCES MODULOS(COD_MODULO);

-- PROGRAMAS MODULOS A PROGRAMAS MODULOS ABIERTOS
ALTER TABLE PROGRAMAS_MODULOS_ABIERTOS ADD CONSTRAINT FK_PROG_MODU
	FOREIGN KEY (COD_PROGRAMAS_MODULOS) REFERENCES PROGRAMAS_MODULOS(COD_PROGRAMAS_MODULOS);

--MATERIAS MODULOS ABIERTOS A DETALLE MATRICULA
ALTER TABLE DETALLE_MATRICULAS ADD CONSTRAINT FK_DMATR
	FOREIGN KEY (COD_PROGRAMAS_MODULOS_ABIERTOS) REFERENCES PROGRAMAS_MODULOS_ABIERTOS(COD_PROGRAMAS_MODULOS_ABIERTOS);


--CALIFICAIONES A PROGRAMAS MODULOS ABIERTOS
ALTER TABLE CALIFICACIONES ADD CONSTRAINT FK_CAL_ES
	FOREIGN KEY (NUM_RECIBO) REFERENCES MATRICULAS (NUM_RECIBO);

-- MATRICULAS A PAGOS
	ALTER TABLE PAGOS ADD CONSTRAINT FK_PAGO_EST
	FOREIGN KEY (NUM_RECIBO) REFERENCES MATRICULAS (NUM_RECIBO);
	--------------------------------------------------------------
	--------------------------------------------------------------
	--------------------------------------------------------------


	-- INSERECION DE DATOS


INSERT INTO ESTUDIANTES(CARNET_EST,CEDULA_EST,NOMBRE_EST ,APELLIDO1_EST,
						APELLIDO2_EST,TELEFONO_EST,CORREO_EST,EDAD_EST,FECHA_INGRESO_EST,BORRADO_EST)
		VALUES		('NA201','208170615','NILS ADRIAN','CARRILLO','JIMENEZ','88880101','208170615@ina.cr',23,'20210603',0),
					('NA202','702420185','Luis Daniel','Chavarría','Espinoza','88880102','702420185@ina.cr',18,'20210603',0),
					('NA203','207990019','GABRIEL ALONSO','GARCIA','AGUILAR','88880103','207990019@ina.cr',26,'20210603',0),
					('NA204','205790810','CESAR LUIS','GARCIA','GONZALES','88880104','205790810@ina.cr',19,'20210603',0),
					('NA205','206470303','TATIANA','MATIAS','JIMENEZ','88880105','206470303@ina.cr',29,'20210603',0),
					('NA206','116870306','LUIS FELIPE','MIRANDA','ROJAS','88880106','116870306@ina.cr',20,'20210603',0),
					('NA207','901390706','CHRISTOPHER FERNANDO','OLIVARES','SALAZAR','88880107','901390706@ina.cr',18,'20210603',0),
					('NA208','208110717','FRANCISCO JOSE','PANIAGUA ','PACHECO','88880108','208110717@ina.cr',25,'20210603',0),
					('NA209','701890285','DANNY JAFET','SOTO','JIMENEZ','88880109','701890285@ina.cr',27,'20210603',0),
					('NA210','701896285','CAMACHO PEDRO','VILLALTA','GUEVARA','88880109','793890285@ina.cr',29,'20310603',0);
				
INSERT INTO PROFESORES(COD_PROF,NOMBRE_PROF,APELLIDO1_PROF,APELLIDO2_PROF,TELEFONO_PROF,CORREO_PROF,CEDULA_PROF,BORRADO_PROF)
VALUES  ('111','Luis Ángel','Chacon','Zuniga','88881111','luis@ina.ac.cr','20813-0015',0),
		('222','Alonso','Bogantes','Rodriguez','88881112','alonso@ina.ac.cr','20813-0016',0),
		('333','Oscar','Pacheco','Vazquez','88881113','pacheco@ina.ac.cr','20813-0017',0),
		('444','Laura','Fonseca','Rojas','88881114','laura@ina.ac.cr','20813-0018',0),
		('555','Irene','Cruz','Fernandez','88881115','irene@ina.ac.cr','20813-0019',0),
		('666','Jimmy','Zuniga','Sanchez','88881116','jimmy@ina.ac.cr','20813-0011',0),
		('777','Nelson','Jimenez','Jimenez','88881117','Nelson@ina.ac.cr','20813-0012',0),
		('888','Rebeca','Aguilar','Navarez','88881118','Rebeca@ina.ac.cr','20813-0013',0),
		('999','Sady','Carrillo','Sanchez','88881119','Sady@ina.ac.cr','20813-0014',0),
		('100','Muricio','Cordero','Lizano','88881120','Mauricio@ina.ac.cr','20813-0045',0);

INSERT INTO MODULOS(COD_MODULO ,NOMBRE_MODULO ,PRECIO_MODULO ,HORAS_MODULO)
VALUES('PROG-DM01','Programación para Android I',250000,120),
	  ('PROG-DM02','Programación para Android II',240000,110),
	  ('PROG-DM03','Programación para Android III',220000,100 ),
	  ('PROG-DM04','Programación para Aplicaciones Mixtas',195000,100 ),

	  ('PROG-SE01','Lógica Computacional',225000,140),
	  ('PROG-SE02','Introducción a Java',335000,150),
	  ('PROG-SE03','Programación Orientada a Objetos',345000,160),

	  ('PROG-PW01','HTML',185000,90),
	  ('PROG-PW02','CSS',175000,60),
	  ('PROG-PW03','JavaScript',180000,70),
	  ('PROG-PW04','BootStrap',185000,90),
	  ('PROG-PW05','NODE JS',185000,90);
	
INSERT INTO PROGRAMAS(COD_PROGRAMA,NOMBRE_PROGRAMA ,PRECIO_PROGRAMA ,HORAS_PROGRAMA)
 VALUES ('PROG-DM81','Programación de dispositivos móviles',905000,430),
		('PROG-SE82','Programación de sistemas de escritorio',905000,450),
		('PROG-PW83','Programación de Páginas Web',910000,400);

INSERT INTO PROGRAMAS_MODULOS(COD_PROGRAMA,COD_MODULO)
 VALUES ('PROG-DM81','PROG-DM01'),
		('PROG-DM81','PROG-DM02'),
		('PROG-DM81','PROG-DM03'),
		('PROG-DM81','PROG-DM04'),

		('PROG-SE82','PROG-SE01'),
		('PROG-SE82','PROG-SE02'),
		('PROG-SE82','PROG-SE03'),

		('PROG-PW83','PROG-PW01'),
		('PROG-PW83','PROG-PW02'),
		('PROG-PW83','PROG-PW03'),
		('PROG-PW83','PROG-PW04'),
		('PROG-PW83','PROG-PW05');		
		 
INSERT INTO LABORATORIO(COD_LABORATORIO,UBICACION)
 VALUES('LAB-01','PABELLON 1, PRIMER PISO'),
	   ('LAB-02','PABELLON 1, PRIMER PISO'),
	   ('LAB-03','PABELLON 2, SEGUNDO PISO'),
	   ('LAB-04','PABELLON 2, SEGUNDO PISO'),
	   ('LAB-05','PABELLON 3, TERCER PISO'),
	   ('LAB-09','PABELLON 3, TERCER PISO');


INSERT INTO PROGRAMAS_MODULOS_ABIERTOS(COD_PROGRAMAS_MODULOS_ABIERTOS,
									COD_PROF,COD_PROGRAMAS_MODULOS, FECHA_INICIO,
									COD_LABORATORIO ,GRUPO ,CUPO)
	VALUES(101,222,1,'20230302','LAB-01','GP-01',30),
		  (102,333,3,'20230302','LAB-02','GP-02',20),
		  (103,444,4,'20230302','LAB-03','GP-03',30),
		  (104,555,5,'20230302','LAB-04','GP-04',25),
		  (105,666,6,'20230302','LAB-05','GP-05',30),
		  (106,777,7,'20230302','LAB-01','GP-06',30),
		  (107,888,8,'20230302','LAB-02','GP-07',15),
		  (108,999,9,'20230302','LAB-03','GP-08',30),
		  (109,100,10,'20230302','LAB-04','GP-09',30),
		  (110,111,2,'20230302','LAB-05','GP-10',30);

INSERT INTO HORARIOS(DIA,HORA_INICIO,HORA_FIN,COD_PROGRAMAS_MODULOS_ABIERTOS)
	VALUES  ('LUNES','7:00','12:00',101),
		    ('LUNES','14:00','19:00',102),
			('MARTES','7:00','12:00',103),
			('MARTES','14:00','19:00',104),
			('MIERCOLES','7:00','12:00',105),
			('MIERCOLES','14:00','19:00',106),
			('JUEVES','7:00','12:00',107),
			('JUEVES','14:00','19:00',108),
			('VIERNES','7:00','12:00',109),
			('VIERNES','14:00','19:00',110)

INSERT INTO CERTIFICACIONES( COD_CERTIFICACION,NOMBRE_CERTIFICADO)
 VALUES(101,'Android 1'),
	   (102,'Android 3'),
	   (103,'Aplicaciones Mixtas '),
	   (104,'logica computacional'),
	   (105,'introduccion a java'),
	   (106,'html'),
	   (107,'android 2'),
	   (108,'css'),
	   (109,'javascript'),
	   (110,'bootstrap');
	  
INSERT INTO MATRICULAS(CARNET_EST,FECHA,MONTO,ENCARGADO_MATRICULA 
					,OBSERVACIONES_MATRICULA,ESTADO_MATRICULA)
		VALUES ('NA201','20210623', 250000,'JUAN','PAGO EN EFECTIVO','ACTIVO' ),
			   ('NA202','20210623', 240000,'JUAN','PAGO EN EFECTIVO','ACTIVO' ),
			   ('NA203','20210623', 220000,'JUAN','PAGO EN TARJETA','ACTIVO' ),
			   ('NA204','20210623', 195000,'JUAN','PAGO EN TARJETA','ACTIVO' ),
			   ('NA205','20210623', 180000,'JUAN','PAGO EN TARJETA','ACTIVO' ),
			   ('NA206','20210623', 185000,'JUAN','PAGO EN EFECTIVO','ACTIVO' ),
			   ('NA207','20210623', 175000,'JUAN','PAGO EN TARJETA','ACTIVO' ),
			   ('NA207','20210623', 250000,'JUAN','PAGO EN EFECTIVO','ACTIVO' ),
			   ('NA208','20210623', 240000,'JUAN','PAGO EN EFECTIVO','ACTIVO' ),
			   ('NA209','20210623', 220000,'JUAN','PAGO EN EFECTIVO','ACTIVO' );
			  
			  UPDATE MATRICULAS SET MONTO=0 WHERE CARNET_EST='NA201'
			  UPDATE MATRICULAS SET MONTO=0 WHERE CARNET_EST='NA208'
			  UPDATE MATRICULAS SET COD_MODULO='PROG_DM02'WHERE CARNET_EST='NA206'
			  UPDATE MATRICULAS SET COD_MODULO='PROG_DM03'WHERE CARNET_EST='NA204'
			  INSERT INTO DETALLE_MATRICULAS(COD_PROGRAMAS_MODULOS_ABIERTOS)
 VALUES(101),
       (102),
	   (103),
	   (104),
	   (105),
	   (106),
	   (107),
	   (108),
	   (109),
	   (110);
	  
INSERT INTO CALIFICACIONES(NUM_RECIBO,CARNET_EST,COD_PROGRAMAS_MODULOS_ABIERTOS,ESTADO_EST)
		 VALUES(1,'NA201',101,'APROBADO'),
			   (2,'NA202',102,'APROBADO'),
			   (3,'NA203',103,'APROBADO'),
			   (4,'NA204',104,'APROBADO'),
			   (5,'NA205',105,'APROBADO'),
			   (6,'NA206',106,'APROBADO'),
			   (7,'NA207',107,'APROBADO'), 
			   (8,'NA208',108,'APROBADO'),
			   (9,'NA209',109,'APROBADO'),
			   (10,'NA210',110,'APROBADO')
			    UPDATE CALIFICACIONES SET NOTA_FINAL=80 WHERE CARNET_EST='NA201'
				UPDATE CALIFICACIONES SET NOTA_FINAL=80 WHERE CARNET_EST='NA203'
INSERT INTO CERTIFICACIONES_PROF(COD_CERTIFICACION,COD_PROF)
		VALUES(101,'111'),
		      (102,'222'),
	          (103,'333 '),
	          (104,'333'),
	          (105,'444'),
	          (106,'111'),
	          (106,'666'),
	          (108,'555'),
	          (108,'999'),
	          (102,'333');

INSERT INTO PAGOS(NUM_RECIBO,CARNET_EST, MONTO_DE_PAGO,FECHA_PAGO)
		VALUES (1,'NA201',50000,'20210628'),--- MOTO PAGO ES LA DEUDA
			   (2,'NA202',50000,'20210628'),
			   (3,'NA203',50000,'20210628'),
			   (4,'NA204',50000,'20210628'),
			   (5,'NA205',50000,'20210628')
			   UPDATE PAGOS SET MONTO_DE_PAGO=0 WHERE CARNET_EST='NA201'
			    UPDATE PAGOS SET MONTO_DE_PAGO=0 WHERE CARNET_EST='NA203'
			   ---------------------------
			   ---------------------------
			   ---------------------------\

			   -- REVISION DE REGISTROS--

			   /*SELECT*FROM CALIFICACIONES
			   SELECT*FROM MATRICULAS
			   SELECT*FROM PROGRAMAS
			   SELECT*FROM PROGRAMAS_MODULOS_ABIERTOS
			   SELECT*FROM MODULOS
			   SELECT*FROM DETALLE_MATRICULAS
			   SELECT*FROM PROFESORES
			   SELECT*FROM ESTUDIANTES
			   SELECT*FROM CERTIFICACIONES
			   SELECT*FROM HORARIOS
			   SELECT*FROM LABORATORIO
			   SELECT*FROM CERTIFICACIONES_PROF
			   SELECT*FROM PROGRAMAS_MODULOS
			   SELECT*FROM PAGOS*/